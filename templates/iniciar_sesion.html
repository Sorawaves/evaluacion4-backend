{% extends 'base.html' %}
{% load static %}

{% block title %}Iniciar Sesión{% endblock %}

{% block content %}
<div class="container" style="padding: 4rem 0;">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card">
                <div class="card-header text-center">
                    <h4 style="font-weight: 300; margin: 0;">Iniciar Sesión</h4>
                </div>
                <div class="card-body" style="padding: 2.5rem;">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <form method="post" action="{% url 'login' %}">
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <label class="form-label" style="font-size: 0.9rem; color: #6c757d;">Usuario</label>
                            <input type="text" name="username" class="form-control" placeholder="Ingresa tu usuario" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label" style="font-size: 0.9rem; color: #6c757d;">Contraseña</label>
                            <input type="password" name="password" class="form-control" placeholder="Ingresa tu contraseña" required>
                        </div>
                        
                        <div class="mb-4 form-check">
                            <input type="checkbox" class="form-check-input" id="remember">
                            <label class="form-check-label" for="remember" style="font-size: 0.9rem; color: #6c757d;">Recordarme</label>
                        </div>
                        
                        <div class="d-grid mb-4">
                            <button type="submit" class="btn btn-primary">Ingresar (Sesión)</button>
                        </div>
                        
                        <div class="d-grid mb-4">
                            <button type="button" class="btn btn-outline-primary" onclick="loginWithJWT()">Obtener Token JWT</button>
                        </div>
                        
                        <div id="jwt-info" class="alert alert-success" style="display: none;">
                            <small><strong>Token guardado:</strong><br>
                            <code id="token-display" style="word-break: break-all; font-size: 0.75rem;"></code></small>
                        </div>
                        
                        <div class="text-center">
                            <small style="color: #6c757d;">¿Olvidaste tu contraseña?</small><br>
                            <a href="#" style="color: var(--accent-rose); text-decoration: none; font-size: 0.9rem;">Recuperar contraseña</a>
                        </div>
                    </form>
                </div>
                <div class="card-footer" style="background: var(--soft-gray); padding: 1.5rem; text-align: center;">
                    <small style="color: #6c757d; font-size: 0.85rem;">
                        Usuarios de prueba:<br>
                        <code style="background: white; padding: 0.2rem 0.5rem; border: 1px solid var(--medium-gray);">admin / admin123</code>
                        <code style="background: white; padding: 0.2rem 0.5rem; border: 1px solid var(--medium-gray);">vendedor_tecnoshop / demo123</code><br>
                        <code style="background: white; padding: 0.2rem 0.5rem; border: 1px solid var(--medium-gray); margin-top: 0.3rem; display: inline-block;">admin_tecnoshop / demo123</code>
                        <code style="background: white; padding: 0.2rem 0.5rem; border: 1px solid var(--medium-gray);">gerente_tecnoshop / demo123</code>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function loginWithJWT() {
    const username = document.querySelector('input[name="username"]').value;
    const password = document.querySelector('input[name="password"]').value;
    
    if (!username || !password) {
        alert('Por favor ingresa usuario y contraseña');
        return;
    }
    
    fetch('/api/token/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ username, password })
    })
    .then(response => response.json())
    .then(data => {
        if (data.access) {
            localStorage.setItem('access_token', data.access);
            localStorage.setItem('refresh_token', data.refresh);
            document.getElementById('jwt-info').style.display = 'block';
            document.getElementById('token-display').textContent = data.access.substring(0, 50) + '...';
            alert('✅ Token JWT guardado en localStorage. Ahora puedes usar la API.');
        } else {
            alert('❌ Error al obtener token');
        }
    })
    .catch(error => {
        alert('❌ Error: ' + error.message);
    });
}
</script>
{% endblock %}
